Rake.application.options.trace_rules = true

def get_sample_names(substring)
    inputs = Dir.glob("inputs/combined_mc/*_weight.log").select {|x| x.include? substring}
    inputs.push(substring+'_weight.log')
    return inputs
end

samples = Hash[
                "vbfHToMTMC" => get_sample_names('VBF_LFV_HToMuTau_M125_13TeV_powheg_pythia8'),
                "ggHToMTMC" => get_sample_names('GluGlu_LFV_HToMuTau_M125_13TeV_powheg_pythia8'),
                "dy" => get_sample_names('DYJetsToLL_M-50_TuneCP5_13TeV-amcatnloFXFX-pythia8'),
                "dy1" => get_sample_names('DY1JetsToLL_M-50_TuneCP5_13TeV-madgraphMLM-pythia8'),
                "dy2" => get_sample_names('DY2JetsToLL_M-50_TuneCP5_13TeV-madgraphMLM-pythia8'),
                "dy3" => get_sample_names('DY3JetsToLL_M-50_TuneCP5_13TeV-madgraphMLM-pythia8'),
                "dy4" => get_sample_names('DY4JetsToLL_M-50_TuneCP5_13TeV-madgraphMLM-pythia8'),
                "w" => get_sample_names('WJetsToLNu_2J_TuneCP5_13TeV-amcatnloFXFX-pythia8'),
                "w1" => get_sample_names('W1JetsToLNu_LHEWpT_50-150_TuneCP5_13TeV-amcnloFXFX-pythia8'),
                "w2" => get_sample_names('W2JetsToLNu_LHEWpT_50-150_TuneCP5_13TeV-amcnloFXFX-pythia8'),
                "w3" => get_sample_names('W3JetsToLNu_TuneCP5_13TeV-madgraphMLM-pythia8'),
                "w4" => get_sample_names('W4JetsToLNu_TuneCP5_13TeV-madgraphMLM-pythia8'),
]

def concat_text_files(the_samples)
    i = 0
    loop do
    	 sh "python concat_new.py #{the_samples[i]} #{the_samples[i+1]} inputs/combined_mc/#{the_samples[i+2]}"
	 sh "rm -rf #{the_samples[i]}"
	 sh "rm -rf #{the_samples[i+1]}"
    	 i += 3
	 if i == 15  #edit this value according to number of samples
       	    break
    	 end
    end
end

task :weightLog => concat_text_files(samples['dy'] + samples['dy1'] + samples['dy2'] + samples['w1'] + samples['w2'])
